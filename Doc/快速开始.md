# 🚀 快速开始指南 (ESP32-S3 版)

本指南专为 **VCC-GND Studio YD-ESP32-S3** 开发板适配。所有引脚均经过重新规划，集中在开发板左侧以便于接线。

## 1. 硬件接线表

请严格按照下表连接模块：

| 模块 | 引脚名称 | ESP32-S3 引脚 | 说明 |
| :--- | :--- | :--- | :--- |
| **DHT11** | DATA | **GPIO 4** | 这里需要 4.7K 上拉电阻(如模块未自带) |
| **LED** | 正极 | **GPIO 5** | 串联电阻，PWM 高电平亮 |
| **蜂鸣器** | 正极 | **GPIO 6** | **低电平触发** (Active Low) |
| **MQ-2** | AO (模拟) | **GPIO 7** | 使用 ADC1 通道 6 读取 |
| **Servo** | 窗帘舵机 | **GPIO 8** | P8 (PWM信号线) |
| **BH1750 (光照)** | SDA | **GPIO 15** | I2C 数据 |
| | SCL | **GPIO 16** | I2C 时钟 |
| **风扇** | PWM/IN | **GPIO 18** | **低电平触发** (PWM调速) |
| **INMP441** | SCK | **GPIO 40** | I2S 时钟 |
| | WS | **GPIO 41** | I2S 字选 |
| | SD | **GPIO 42** | I2S 数据 |
| **电源** | VCC/GND | 3.3V / GND | 所有模块共地 |

> **注意**: 风扇和蜂鸣器均为低电平触发。即 GPIO 输出低电平时工作。

## 2. 软件配置

1.  **WiFi 配置**:
    已在 `components/config/config.h` 中预设 WiFi: `007` / `liujiaming`。如需修改请编辑该文件。

2.  **语音模型配置**:
    默认唤醒词为"你好小智"。如需修改可在 `config.h` 中更改 `SR_WAKENET_MODEL`。

## 3. 编译与烧录

1.  **编译**:
    ```bash
    idf.py build
    ```

2.  **烧录**:
    连接 Type-C 线到 **USB 串口**。
    ```bash
    idf.py -p /dev/ttyACM0 flash monitor
    ```
    *(注: S3 的端口可能是 `/dev/ttyACM0` 而不是 `ttyUSB0`)*

## 4. 运行与验证

1.  **观察启动日志**:
    烧录成功后，终端会自动打开监视器。观察日志输出。
    当看到类似日志时，说明系统已就绪：
    ```
    I (3981) WIFI: Connected to AP SSID: 007
    I (3991) WIFI: Got IP: 192.168.1.109
    I (4001) HTTP_SERVER: HTTP server started on port 80
    I (4150) VR: Voice recognition initialized
    ```
    **记下这个 IP 地址 (如 192.168.1.109)**。

2.  **手机/电脑连接**:
    *   确保您的手机或电脑连接到了**同一个 WiFi (007)**。
    *   打开浏览器（Safari/Chrome），在地址栏输入刚才的 IP 地址：`http://192.168.1.109`

## 5. 系统使用指南

### Web 控制台功能
进入网页后，您将看到两个主要区域：

*   **📊 环境监测面板**:
    *   **温度/湿度**: 实时显示室内温湿度，约 2 秒刷新一次。
    *   **光照**: 显示当前环境亮度 (Lux)。
    *   **烟雾**: 显示当前烟雾浓度数值（正常空气约为几百，烟雾环境下会飙升）。

*   **💡 设备控制面板**:
    *   **LED**: 点击按钮开关灯。下方滑块可调节亮度。
    *   **风扇**: 点击按钮开关。下方滑块调节风速 (0-255)。
        *   *注意: 如果触发了高温自动排风，手动设置可能会被自动逻辑覆盖。*
    *   **窗帘**: 点击切换开启/关闭状态 (控制舵机转动 0°<->180°)。

### 自动化逻辑测试
您可以尝试触发以下场景来验证系统：

1.  **测试自动灯光**:
    *   用手遮挡住 BH1750 光照传感器（模拟天黑）。
    *   观察网页上的 LED 状态是否自动变变为 ON，且亮度自动调至最大。
    *   移开手，LED 应自动关闭。

2.  **测试高温排风**:
    *   用手握住 DHT11 传感器，或对其哈气使其升温。
    *   当温度超过 30℃ 时，风扇应自动开启中速。
    *   当温度超过 35℃ 时，风扇应变为全速。

3.  **测试烟雾报警**:
    *   使用打火机（不要点火，只按出气）在 MQ-2 传感器旁释放气体。
    *   观察网页“烟雾”数值飙升。
    *   当数值 > 1000 时，蜂鸣器应报警，且风扇全速开启。

4.  **测试语音控制**:
    *   对着麦克风说 "**你好小智**"。
    *   听到蜂鸣器"滴"一声后，说出命令：
        *   "**打开灯光**" -> LED 亮起。
        *   "**关闭风扇**" -> 风扇停止。

### API 开发调试
如果您想开发自己的 APP 或集成到 HomeAssistant，可以直接调用以下 HTTP 接口：

*   获取所有状态: `GET http://<IP>/api/data`
*   控制风扇速度: `GET http://<IP>/api/fan/speed?value=200`
*   控制灯光亮度: `GET http://<IP>/api/led/brightness?value=128`

