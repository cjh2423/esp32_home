# ESP32 智能家居控制系统

这是一个基于 ESP32-S3 的智能家居环境监测与控制系统。集成了多种传感器（温湿度、光照、烟雾）、执行器（灯光、排风扇、窗帘）和**语音识别**功能，并通过 WiFi 提供 Web 交互界面。

## 🌟 功能特性

### 1. 环境监测
*   **温湿度监测** (DHT11)：实时检测环境温度和湿度。
*   **光照监测** (BH1750)：检测环境光照强度 (Lux)。
*   **烟雾/气体监测** (MQ-2)：检测可燃气体和烟雾浓度。

### 2. 智能控制
*   **灯光控制**：支持 PWM 无级调光，具备光控自动开关功能。
*   **排风扇控制** (PWM)：支持 PWM 调速（低电平触发），具备高温自动排风和烟雾报警排风功能。
*   **窗帘控制**：舵机控制窗帘开关。

### 3. 🎤 语音识别 (NEW!)
*   **离线语音识别**：使用 ESP-SR 库实现本地语音识别，无需联网。
*   **唤醒词**："你好小智"
*   **命令词**：
    *   "打开灯光" / "关闭灯光"
    *   "打开风扇" / "关闭风扇"
*   **硬件**：INMP441 数字麦克风

### 4. Web 交互
*   **实时数据**：Web 面板实时刷新显示传感器数值。
*   **远程控制**：通过 Web 页面控制所有设备的开关和状态。
*   **RESTful API**：提供标准 JSON API。

## 🔌 硬件连接

| 模块 | 引脚 (GPIO) | 备注 |
| :--- | :--- | :--- |
| **DHT11** | GPIO 4 | 温湿度传感器 |
| **BH1750** | SDA: 15, SCL: 16 | I2C 光照传感器 |
| **MQ-2** | ADC1_CH6 (GPIO 7) | 烟雾传感器 (模拟量) |
| **LED** | GPIO 5 | PWM 控制，高电平有效 |
| **风扇 (Fan)** | GPIO 18 | PWM 控制，**低电平触发** |
| **蜂鸣器** | GPIO 6 | 低电平报警 |
| **舵机** | GPIO 8 | 窗帘控制 |
| **INMP441** | SCK: 40, WS: 41, SD: 42 | I2S 数字麦克风 |

## 🚀 快速开始

1.  **配置 WiFi 和语音**：
    打开 `components/config/config.h`，可修改：
    *   `WIFI_SSID` / `WIFI_PASS`：WiFi 配置
    *   `SR_WAKENET_MODEL`：唤醒词模型（默认 "你好小智"）
    *   `INMP441_I2S_*`：麦克风引脚配置

2.  **编译与烧录**：
    ```bash
    idf.py build
    idf.py -p /dev/ttyACM0 flash monitor
    ```

3.  **访问控制台**：
    烧录成功后，终端会打印 ESP32 获取到的 IP 地址。
    在浏览器中访问该 IP 地址即可看到控制面板。

4.  **语音控制**：
    对着麦克风说 "你好小智"，听到蜂鸣器提示音后，说出命令词即可控制设备。

## 📂 目录结构

*   `main/`: 主程序入口。
*   `components/`:
    *   `config`: 系统配置（包含语音识别配置）。
    *   `sr`: 语音识别模块（INMP441 驱动 + ESP-SR 集成）。
    *   `app_control`: 应用控制逻辑（包含语音命令回调）。
    *   `wifi` / `web_ui`: WiFi 连接及 HTTP 服务器。
    *   `dht11` / `bh1750` / `mq2`: 传感器驱动。
    *   `led` / `fan` / `motor` / `buzzer`: 执行器驱动。
*   `Doc/`: 详细文档。

## 📝 自动化逻辑说明

*   **烟雾报警**：MQ-2 数值 > 1000 -> 蜂鸣器响，风扇全速开启。
*   **温度控制**：
    *   T > 35℃: 风扇全速 (255)
    *   T > 32℃: 风扇高速 (200)
    *   T > 30℃: 风扇中速 (150)
    *   T < 15℃: 风扇关闭
*   **光照控制**：Lux < 100 -> 自动开启 LED。
*   **语音控制**：唤醒后 5 秒内说出命令词控制设备。
